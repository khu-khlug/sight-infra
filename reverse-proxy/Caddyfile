{
	email we_are@khlug.org

	# LetsEncrypt 테스트용 ACME CA
	# 실제 배포 시 아래 라인을 주석 처리해주세요.
	# @see https://caddyserver.com/docs/caddyfile/options#acme-ca
	# acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
}

api.khlug.org {
	reverse_proxy {
		dynamic srv {
			name nestjs-backend.sight.prod
			refresh 10s
		}
	}
}

api-v2.khlug.org {
	reverse_proxy {
		dynamic srv {
			name spring-backend.sight.prod
			refresh 10s
		}
	}
}

www.khlug.org,
khlug.org,
developers.khlug.org,
hello.khlug.org,
inventory.khlug.org,
inven.khlug.org,
library.khlug.org,
lib.khlug.org {
	@cors_preflight {
		method OPTIONS
		header Origin "https://app.khlug.org"
		header Access-Control-Request-Method *
	}

	handle @cors_preflight {
		header {
			Access-Control-Allow-Origin      "https://app.khlug.org"
			Access-Control-Allow-Methods     "GET, POST, PUT, PATCH, DELETE, OPTIONS"
			Access-Control-Allow-Headers     *
			Access-Control-Allow-Credentials "true"
		}
		respond "" 204
	}

	header {
		Access-Control-Allow-Origin      "https://app.khlug.org"
		Access-Control-Allow-Credentials "true"
	}

	reverse_proxy {
		dynamic srv {
			name laravel-backend.sight.prod
			refresh 10s
		}
	}
}
